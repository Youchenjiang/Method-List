# The Infrastructure Foundation

## 1. Overview: The Physical Reality

The **Intelligent Architecture** and **Attack Lifecycle** are entirely dependent on a stable, robust physical foundation. If the device farm is unstable or the network proxy leaks, the AI Agents will fail.

This document serves as the **Engineering Spec** for the physical and operating system layers of the framework.

---

## 2. Device Farm Engineering

### 2.1 The "Battery-less" Modification
**Problem**: Continuous charging cycles and high CPU load (Fuzzing) cause Li-ion batteries to swell, creating a fire hazard and physical destruction of the server rack.
**Solution**: Converting devices to direct DC power.

*   **Component**: **Buck Converter (DC-DC Step-Down)**.
    *   *Input*: 5V (USB Bus).
    *   *Output*: 3.8V - 4.2V (simulating battery voltage).
*   **Implementation**:
    1.  Disassemble the Pixel device.
    2.  Remove the physical battery and the BMS (Battery Management System) board.
    3.  Solder the Buck Converter output to the battery connector points on the motherboard.
    4.  **Critical Step**: Some kernels verify battery temperature. A **10kΩ Resistor** must be soldered between the NTC (Temp) pin and Ground to simulate a constant "25°C" temperature, preventing the OS from shutting down due to "Thermal Runaway" (missing sensor).

### 2.2 USB Scalability & Bandwidth
**Problem**: Connecting 20+ devices creates USB bandwidth congestion and ARP storms.
**Solution**: Isolated Hub & Network Topology.

*   **Hardware**: Industrial USB Hubs (e.g., Acasis 16-port) with separate power supply (12V/10A+).
*   **Data Layout**:
    *   Use **USB 3.0** for the Host connection to handle high-bandwidth ADB Screencast streams.
    *   Devices are logically separated using `udev` rules on the Linux Host to assign persistent symlinks (e.g., `/dev/android_01`, `/dev/android_02`) based on Serial Number.

---

## 3. The Transparent Operating System (Custom ROM)

Store-bought phones are "noisy" and "locked". We require a custom AOSP (Android Open Source Project) build to provide absolute control and invisibility.

### 3.1 Hiding Root (Kernel-Level Stealth)
**Problem**: Apps use `Runtime.exec("su")` or check for `/system/bin/su` to detect Root.
**Solution**: **Systemless Root is not enough.** We use **Source-Modification Root**.

*   **AOSP Patch**:
    *   Modify `system/core/libcutils/fs_config.cpp` to grant `AID_ROOT` capabilities to our specific Agent Package UID.
    *   Rename the `su` binary to a random string (e.g., `magicsocks`).
    *   Modify the Agent's code to call `magicsocks` instead of `su`.
    *   *Result*: Standard Root detection logic (looking for "su") returns `False`, but our Agent has full root access.

### 3.2 Certificate Injection (Network Trust)
**Problem**: Android 7+ ignores User-Installed CA Certificates. Mitmproxy cannot decrypt traffic.
**Solution**: Bake the CA into the System Image.

*   **Implementation**:
    1.  Generate the Mitmproxy CA hash: `openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem`.
    2.  Rename the cert to `<hash>.0`.
    3.  During AOSP Build: Place the file in `system/core/rootdir/etc/security/cacerts/`.
    4.  *Result*: The device treats our Proxy as a trusted Root Authority (like VeriSign or DigiCert) out of the box. No Magisk module required.

---

## 4. Network Topology & Isolation

### 4.1 Reverse Tethering (The Air-Gap)
**Policy**: Devices MUST NOT use Wi-Fi.
*   **Reason 1 (Stability)**: Wi-Fi is prone to interference in dense racks.
*   **Reason 2 (Security)**: Wi-Fi allows apps to scan the local network (LAN Discovery).
*   **Implementation**:
    *   Enable **Gnirehtet** (Reverse Tethering).
    *   Traffic Flow: `App -> Android Kernel (VPN/Tun) -> USB -> Host PC -> Mitmproxy -> Internet`.
    *   This forces 100% of traffic through our inspection point.

### 4.2 Transparent Proxying
**Configuration**:
The Host machine uses `iptables` to redirect all traffic coming from the USB interface (e.g., `usb0`) to the Mitmproxy listening port.

```bash
# Example Logic (Conceptual)
iptables -t nat -A PREROUTING -i usb+ -p tcp --dport 80 -j REDIRECT --to-port 8080
iptables -t nat -A PREROUTING -i usb+ -p tcp --dport 443 -j REDIRECT --to-port 8080
```

---

## 5. Summary of Specs

| Constraint    | Specification                                      |
| :------------ | :------------------------------------------------- |
| **Power**     | Direct DC (Buck Converter) + NTC Spoofing Resistor |
| **Root**      | Source-modified `su` binary (Renamed)              |
| **Network**   | USB Reverse Tethering + System CA Injection        |
| **Bandwidth** | Dedicated USB 3.0 Controllers per 10 devices       |
| **Recovery**  | OverlayFS snapshotting for instant "Factory Reset" |

This infrastructure ensures that when the AI Agent commands "Run Attack", the physical reality complies instantly, silently, and reliably.
