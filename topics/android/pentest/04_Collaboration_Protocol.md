# Collaboration Protocol: The Rules of Engagement

## 1. Overview: De-Ambiguity

The biggest risk in a Human-AI system is **Ambiguity**.
*   *"Run that script"* -> Which script? On which device?
*   *"Is it vulnerable?"* -> According to what standard?

This document defines the **Decision Matrix** (Who decides what?) and the **Structured Command Protocol** (RPC-over-Chat) to ensure the system operates deterministically.

---

## 2. The Decision Matrix

We strictly define the "License to Act". AI is **NOT** allowed to make judgments on High-Impact items without Human Approval.

| Activity Category        | Specific Action           | AI Authority      | Human Authority    | SLA (Human) |
| :----------------------- | :------------------------ | :---------------- | :----------------- | :---------- |
| **Reconnaissance**       | Static Scan (MobSF)       | ✅ **Autonomous**  | Review Summary     | 24h         |
| **Reconnaissance**       | Decompile & Map           | ✅ **Autonomous**  | -                  | -           |
| **Attack (Safe)**        | Read-Only Fuzzing         | ✅ **Autonomous**  | -                  | -           |
| **Attack (Destructive)** | Write Fuzzing (DB/FS)     | ❌ **Forbidden**   | ✅ **Must Approve** | 30m         |
| **Exploitation**         | Bypass Auth / RASP        | ⚠️ **Assist Only** | ✅ **Must Drive**   | N/A         |
| **Reporting**            | Flag Potential Bug        | ✅ **Autonomous**  | -                  | -           |
| **Reporting**            | **Confirm Vulnerability** | ❌ **Forbidden**   | ✅ **Must Verify**  | 4h          |

*   **Autonomous**: AI acts immediately.
*   **Assist Only**: AI provides code/data, Human executes.
*   **Forbidden**: AI ignores command unless explicitly overridden with `sudo` level authorization by a Senior Engineer.

---

## 3. Structured Command Protocol (SCP)

Natural language is for *discussion*. Structured commands are for *execution*.
The system ignores "Chatter" when executing critical tasks. It only obeys **SCP Payloads**.

### 3.1 Command Format
All operational commands must follow this YAML-like structure within the chat or command palette:

```yaml
/cmd [VERB] [TARGET] {PARAMETERS}
```

### 3.2 Common Command Definitions

#### A. Triage & Scan
```bash
/scan target:com.example.app mode:deep
# Triggers: MobSF + APKTool + String Extraction
# Output: Triage Summary Report
```

#### B. Fuzzing (The Tactician)
```bash
/fuzz target:LoginActivity.username
      payload_set:sql_injection_basic
      rate_limit:500ms
      stop_on:crash
# Triggers: ADB Input Generation loop
# Output: Logcat snippet of the crash or "No Impact"
```

#### C. Verification (The Auditor)
```bash
/verify bug_id:POTENTIAL-001
        method:manual_replay
        script:scripts/poc/auth_bypass.py
# Triggers: Clean Device Reset -> Script Execution -> OCR Validation
# Output: "CONFIRMED" or "FALSE_POSITIVE"
```

---

## 4. The "Handoff" Handshake

To prevent dropped tasks, every Handoff between Human and AI requires a **Handshake**.

### 4.1 AI to Human (Requesting Review)
When AI finds a potential issue, it creates a **Task Ticket**:
> **[TICKET-101]** Potential SQLi in Search Bar.
> *   **Evidence**: Logcat errors.
> *   **Status**: `WAITING_FOR_HUMAN`
> *   **Action**: Please run `/verify bug_id:101` or `/dismiss bug_id:101`.

**The System PAUSES related tasks until Ticket 101 is resolved.**

### 4.2 Human to AI (Delegating Grunt Work)
When Human needs a script:
> **[TASK]** Generate Frida Hook for `com.a.b.c()`.
> *   **Constraint**: Must return `true`.
> *   **Context**: See `SecurityUtils.smali`.

AI responds with code. **Human MUST explicitly type `/approve`** before the code is pushed to any device.

---

## 5. Emergency Protocols

### 5.1 The "Stop-All" Switch
If the Fuzzer goes rogue or the device overheats:
*   **Command**: `/abort` (Global Interrupt)
*   **Effect**:
    1.  Kills all ADB processes.
    2.  Kills all Frida sessions.
    3.  Marks current Task as `ABORTED`.

### 5.2 The "Brain Wipe"
If the AI enters a hallucination loop:
*   **Command**: `/reset_context`
*   **Effect**:
    1.  Clears the LLM Context Window.
    2.  Reloads the "Current Task State" from the SQL Database.
    3.  Restores "Sanity".
