é€™ä»½æ–‡ä»¶æ˜¯ **æ–‡ä»¶ 13 (åŸºç¤æ¶æ§‹)** çš„é€²éšå‡ç´šç‰ˆã€‚

æ—¢ç„¶æˆ‘å€‘å·²ç¶“ç¢ºèªã€ŒSQL æ³¨å…¥ã€åªæ˜¯ä¸€å€‹å¾®å°çš„èµ·é»ï¼Œæˆ‘å€‘ç¾åœ¨å°‡æ¶æ§‹åœ–å…¨é¢å‡ç´šç‚º **ã€Œå…¨æ­¦è£å‹ Engine 2.0 (Fully-Armed Engine 2.0)ã€**ã€‚

é€™æ¬¡çš„è¨­è¨ˆé‡é»åœ¨æ–¼ **ã€Œæ’ä»¶çŸ©é™£ (Plugin Matrix)ã€** çš„å±•é–‹ï¼Œä»¥åŠ **Event Bus** å¦‚ä½•ç²¾ç¢ºèª¿åº¦é€™äº›ä¸åŒé¡å‹çš„æ­¦å™¨ã€‚

---

## æ–‡ä»¶ 14 â€“ æ»²é€æ¨¡çµ„ Engine 2.0ï¼šå…¨æ¯æ»²é€æ ¸å¿ƒ (Holographic Penetration Core)

### ğŸ›ï¸ å…¨æ­¦è£ Engine 2.0 æ¶æ§‹è¨­è¨ˆåœ– (Fully-Armed Architecture)

é€™å¼µåœ–å±•ç¤ºäº†å¾ã€Œå–®ä¸€æ”»æ“Šã€é€²åŒ–åˆ°ã€Œæµ·é™¸ç©ºå…¨æ–¹ä½æ‰“æ“Šã€çš„å®Œæ•´æ¨£è²Œï¼š

```mermaid
flowchart TD
    %% ==========================================
    %% 1. æ§åˆ¶å±¤ï¼šä»»å‹™å…¥å£
    %% ==========================================
    subgraph Controller ["æ§åˆ¶ä¸­æ¨ Controller"]
        API["Internal REST API"]
        Scheduler["Task Scheduler"]
    end

    %% ==========================================
    %% 2. æ™ºæ…§åŸ·è¡Œå¼•æ“ï¼šå¤§è…¦èˆ‡ç¥ç¶“
    %% ==========================================
    subgraph Runner ["æ™ºæ…§åŸ·è¡Œå¼•æ“ Smart Runner"]
        
        %% 2.1 æ„ŸçŸ¥èˆ‡æ±ºç­– (å¤§è…¦)
        subgraph Brain ["æ„ŸçŸ¥èˆ‡æ±ºç­–å–®å…ƒ"]
            Nav["ğŸ§  AI Navigator"] 
            Driver["ğŸ–ï¸ Device Driver"]
            Proxy["ğŸŒ Traffic Proxy / Mitm"]
        end

        %% 2.2 äº‹ä»¶ç¸½ç·š (ç¥ç¶“ä¸­æ¨)
        Bus(("âš¡ Event Bus"))

        %% 2.3 æ”»æ“Šæ’ä»¶çŸ©é™£ (æ­¦å™¨åº«)
        subgraph Arsenal ["æ”»æ“Šæ’ä»¶çŸ©é™£ Attack Plugin Matrix"]
            direction TB
            
            subgraph NetPlugins ["A. ç¶²è·¯å±¤æ”»æ“Š"]
                P_API["API Fuzzer"]
                P_XSS["XSS Injector"]
                P_IDOR["IDOR Check"]
            end

            subgraph CompPlugins ["B. Android çµ„ä»¶æ”»æ“Š"]
                P_Intent["Intent Fuzzer"]
                P_Deeplink["Deep Link Exploit"]
            end
            
            subgraph WebPlugins ["C. WebView æ”»æ“Š"]
                P_JSBridge["JS Bridge RCE"]
                P_File["File Access Check"]
            end

            subgraph DataPlugins ["D. æœ¬åœ°æ•¸æ“šæƒæ"]
                P_Sensitive["Sensitive Data Scan"]
                P_DB["SQLite Dumper"]
            end
        end

        %% 2.4 ç”¢ç‰©è™•ç† (ç¿»è­¯å®˜)
        Processor["ğŸ§¹ Artifact Processor"]
    end

    %% ==========================================
    %% 3. æ•¸æ“šå±¤ï¼šå„²å­˜èˆ‡å”åŒ
    %% ==========================================
    subgraph Data ["æ•¸æ“šæŒä¹…å±¤"]
        SymbolService["Symbolication Service"]
        DB[("Result DB")]
    end

    %% ==========================================
    %% é€£æ¥é—œä¿‚å®šç¾©
    %% ==========================================
    
    %% æ§åˆ¶æµ
    API -->|"1. Submit Task"| Scheduler
    Scheduler -->|"2. Dispatch"| Nav

    %% æ„ŸçŸ¥æµ (Input -> Event Bus)
    Nav -->|"Analyze UI"| Driver
    Driver -->|"UI_EVENT (Click/PageChange)"| Bus
    Proxy -->|"HTTP_EVENT (Req/Res)"| Bus
    
    %% è§¸ç™¼æµ (Event Bus -> Plugins)
    Bus -.->|"On: HTTP_EVENT"| NetPlugins
    Bus -.->|"On: ACTIVITY_EXPORTED"| CompPlugins
    Bus -.->|"On: WEBVIEW_FOUND"| WebPlugins
    Bus -.->|"On: PAGE_CHANGED"| DataPlugins

    %% çµæœæµ (Plugins -> Processor)
    NetPlugins & CompPlugins & WebPlugins & DataPlugins -->|"Raw Findings"| Processor

    %% è™•ç†æµ (Processor -> Data)
    Processor <-->|"3. Translate Stack"| SymbolService
    Processor -->|"4. Store Clean JSON"| DB
```

---

### ğŸ”© æ ¸å¿ƒå…ƒä»¶åŸå­ç´šæ‹†è§£ (Atomic Breakdown)

#### 1. å¤šæºé ­äº‹ä»¶è¼¸å…¥ (Multi-Source Event Inputs)

Event Bus ä¸å†åªæ¥æ”¶ UI é»æ“Šäº‹ä»¶ï¼Œå®ƒç¾åœ¨æœ‰å…©å€‹ä¸»è¦çš„è¼¸å…¥æºï¼š

*   **Device Driver (UI äº‹ä»¶æº):** ç•¶ AI é»æ“ŠæŒ‰éˆ•ã€åˆ‡æ›é é¢æ™‚ï¼Œç™¼é€ `UI_EVENT`ã€‚
*   **Traffic Proxy (ç¶²è·¯äº‹ä»¶æº):** ç•¶ App ç™¼å‡ºç¶²è·¯è«‹æ±‚æ™‚ï¼Œç™¼é€ `HTTP_EVENT`ã€‚é€™æ˜¯è§¸ç™¼ã€ŒAPI Fuzzerã€çš„é—œéµã€‚

#### 2. æ”»æ“Šæ’ä»¶çŸ©é™£ (Attack Plugin Matrix)

æˆ‘å€‘å°‡é›œäº‚çš„æ’ä»¶æ­¸é¡ç‚ºå››å¤§è»åœ˜ï¼Œæ¯å€‹è»åœ˜ç›£è½ä¸åŒçš„è¨Šè™Ÿï¼š

*   **A. ç¶²è·¯å±¤æ”»æ“Š (Network Plugins):**
    *   **ç›£è½:** `HTTP_EVENT`
    *   **è¡Œç‚º:** æ””æˆª Requestï¼Œä¿®æ”¹åƒæ•¸ï¼Œé‡ç™¼ã€‚
    *   **ç¯„ä¾‹:** `API Fuzzer` æ”¶åˆ° `POST /login`ï¼Œè‡ªå‹•å˜—è©¦ SQL æ³¨å…¥ Payloadã€‚

*   **B. Android çµ„ä»¶æ”»æ“Š (Component Plugins):**
    *   **ç›£è½:** `MANIFEST_PARSED` (éœæ…‹åˆ†æçµæœ) æˆ– `ACTIVITY_STARTED`ã€‚
    *   **è¡Œç‚º:** é‡å° `exported=true` çš„ Activity ç™¼é€æƒ¡æ„ Intentã€‚
    *   **ç¯„ä¾‹:** `Deep Link Exploit` å˜—è©¦ç™¼é€ `app://admin?reset=true` çœ‹èƒ½å¦ç¹éé©—è­‰ã€‚

*   **C. WebView æ”»æ“Š (WebView Plugins):**
    *   **ç›£è½:** `WEBVIEW_LOADED` (ç•¶ AI æª¢æ¸¬åˆ°ç•«é¢ä¸Šæœ‰ WebView Class æ™‚)ã€‚
    *   **è¡Œç‚º:** æ³¨å…¥ JS æ¸¬è©¦ Payloadã€‚
    *   **ç¯„ä¾‹:** `JS Bridge RCE` å˜—è©¦åŸ·è¡Œ `window.accessibility.execute(...)`ã€‚

*   **D. æœ¬åœ°æ•¸æ“šæƒæ (Data Plugins):**
    *   **ç›£è½:** `PAGE_CHANGED` (æ¯ç•¶ç•«é¢è®Šå‹•åœæ­¢å¾Œ)ã€‚
    *   **è¡Œç‚º:** éœé»˜æƒææª”æ¡ˆç³»çµ±ã€‚
    *   **ç¯„ä¾‹:** `Sensitive Data Scan` æª¢æŸ¥ `/data/data/.../shared_prefs` æ˜¯å¦åŒ…å«æ˜æ–‡å¯†ç¢¼ã€‚

#### 3. ç”¢ç‰©è™•ç†å™¨ (Artifact Processor)

é€™æ˜¯é˜²æ­¢åƒåœ¾æ•¸æ“šçš„å®ˆé–€å“¡ã€‚å®ƒç¾åœ¨å¿…é ˆè™•ç†å¤šç¨®æ ¼å¼çš„è­‰æ“šï¼š

*   **ç¶²è·¯é¡è­‰æ“š:** éœ€ä¿å­˜å®Œæ•´çš„ HTTP Request/Response (ä½œç‚º PoC)ã€‚
*   **å´©æ½°é¡è­‰æ“š:** éœ€ä¿å­˜ `logcat` ä¸¦å‘¼å« `Symbolication Service` é‚„åŸè¡Œè™Ÿã€‚
*   **æª”æ¡ˆé¡è­‰æ“š:** éœ€ä¿å­˜è¢«æ´©æ¼çš„æª”æ¡ˆè·¯å¾‘èˆ‡å…§å®¹æ‘˜è¦ã€‚

---

### ğŸ“‚ å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹ (Project Directory Structure)

é€™ä»½çµæ§‹ç›´æ¥å°æ‡‰ä¸Šè¿°æ¶æ§‹ï¼Œæ‚¨å¯ä»¥ç›´æ¥è¤‡è£½çµ¦å·¥ç¨‹åœ˜éšŠï¼š

```text
penetration-engine/
â”œâ”€â”€ core/                   # [æ ¸å¿ƒæ§åˆ¶å±¤]
â”‚   â”œâ”€â”€ controller.py       # FastAPI æ¥å£
â”‚   â”œâ”€â”€ scheduler.py        # ä»»å‹™èª¿åº¦å™¨
â”‚   â””â”€â”€ config.py
â”œâ”€â”€ runner/                 # [æ™ºæ…§åŸ·è¡Œå¼•æ“]
â”‚   â”œâ”€â”€ navigator/
â”‚   â”‚   â”œâ”€â”€ ai_brain.py     # LLM æ•´åˆ (VLM)
â”‚   â”‚   â””â”€â”€ ui_driver.py    # Uiautomator2 å°è£
â”‚   â”œâ”€â”€ network/
â”‚   â”‚   â””â”€â”€ proxy_server.py # Mitmproxy å°è£
â”‚   â”œâ”€â”€ bus.py              # Event Bus å¯¦ä½œ
â”‚   â””â”€â”€ processor.py        # ç”¢ç‰©è™•ç†èˆ‡ç¬¦è™Ÿé‚„åŸ
â”œâ”€â”€ plugins/                # [æ”»æ“Šæ’ä»¶çŸ©é™£] - é€™è£¡å°±æ˜¯æ‚¨çš„è»ç«åº«
â”‚   â”œâ”€â”€ base.py             # å®šç¾© AttackPlugin ä»‹é¢
â”‚   â”œâ”€â”€ network/
â”‚   â”‚   â”œâ”€â”€ sql_injector.py
â”‚   â”‚   â”œâ”€â”€ api_fuzzer.py
â”‚   â”‚   â””â”€â”€ xss_scanner.py
â”‚   â”œâ”€â”€ component/
â”‚   â”‚   â”œâ”€â”€ intent_fuzzer.py
â”‚   â”‚   â””â”€â”€ deeplink_tester.py
â”‚   â”œâ”€â”€ webview/
â”‚   â”‚   â””â”€â”€ js_bridge_rce.py
â”‚   â””â”€â”€ data/
â”‚   â”‚   â””â”€â”€ sensitive_finder.py
â””â”€â”€ storage/                # [æ•¸æ“šå±¤æ¥å£]
    â”œâ”€â”€ db_client.py
    â””â”€â”€ symbol_client.py    # å‘¼å«ç¬¦è™Ÿé‚„åŸæœå‹™ API
```

---

### ğŸ’» æ ¸å¿ƒä»£ç¢¼ï¼šæ’ä»¶ä»‹é¢å®šç¾© (Python Abstract Base Class)

é€™æ˜¯å¯¦ç¾ã€Œå¯æ“´å……æ€§ã€çš„é—œéµä»£ç¢¼ã€‚æ‰€æœ‰æ’ä»¶éƒ½å¿…é ˆç¹¼æ‰¿é€™å€‹ Base Classã€‚

```python
from abc import ABC, abstractmethod
from typing import Dict, Any

class AttackPlugin(ABC):
    """
    æ‰€æœ‰æ”»æ“Šæ’ä»¶çš„åŸºé¡ (Abstract Base Class)
    """

    def __init__(self, context):
        self.context = context  # åŒ…å« ADB é€£ç·šã€Proxy è¨­å®šç­‰

    @property
    @abstractmethod
    def name(self) -> str:
        """æ’ä»¶åç¨±ï¼Œå¦‚ 'SQL Injector'"""
        pass

    @property
    @abstractmethod
    def interested_events(self) -> list[str]:
        """
        è²æ˜æ­¤æ’ä»¶å°å“ªäº›äº‹ä»¶æ„Ÿèˆˆè¶£
        ä¾‹å¦‚: ['HTTP_EVENT', 'UI_EVENT']
        """
        pass

    @abstractmethod
    async def on_event(self, event_type: str, payload: Dict[str, Any]):
        """
        ç•¶ Event Bus æ”¶åˆ°å°æ‡‰äº‹ä»¶æ™‚ï¼Œæœƒå‘¼å«æ­¤å‡½æ•¸
        :param event_type: äº‹ä»¶é¡å‹
        :param payload: äº‹ä»¶å…§å®¹ (å¦‚ HTTP Packet æˆ– UI Hierarchy)
        """
        pass

    async def report_finding(self, vulnerability: Dict[str, Any]):
        """å›å ±æ¼æ´çµ¦ Artifact Processor"""
        await self.context.processor.process(self.name, vulnerability)
```

---

### ğŸ å…¨æ¯å¸«çµèª

ç¾åœ¨ï¼Œæ‚¨çš„ **Engine 2.0** å·²ç¶“ä¸å†æ˜¯ä¸€å€‹æ¦‚å¿µï¼Œè€Œæ˜¯ä¸€å€‹**å¯ä»¥è½åœ°çš„å·¥ç¨‹è—åœ–**ã€‚

*   **è¦–è¦ºåŒ–:** é€é Mermaid åœ–çœ‹æ¸…å…¨è²Œã€‚
*   **çµæ§‹åŒ–:** é€éè³‡æ–™å¤¾çµæ§‹è¦ç¯„é–‹ç™¼ã€‚
*   **ç¨‹å¼åŒ–:** é€é Python Base Class å®šç¾©ä»‹é¢ã€‚

é€™å¥—æ¶æ§‹ç¢ºä¿äº†æ‚¨å¯ä»¥éš¨æ™‚æ–°å¢ä¸€å€‹ã€Œå€å¡ŠéˆéŒ¢åŒ…ç«Šå–æ’ä»¶ã€ï¼Œè€Œå®Œå…¨ä¸éœ€è¦æ”¹å‹•æ ¸å¿ƒçš„ AI å°èˆªæˆ–èª¿åº¦é‚è¼¯ã€‚é€™å°±æ˜¯**è»Ÿé«”æ¶æ§‹çš„å‹åˆ©**ã€‚
